;;  -*- emacs-lisp -*-
;; cwyang's Emacs setting 
;; 2011.03.27
;;

(setq inhibit-splash-screen t)
(global-font-lock-mode 1)
(tool-bar-mode -1) ; go away toolbar

(add-to-list 'load-path "~/emacs/")
(add-to-list 'load-path "~/emacs/color-theme-6.6.0")

(add-to-list 'exec-path "/usr/local/bin")
(setenv (concat "/usr/local/bin" (getenv "PATH")))

(or (getenv "TERM") (setenv "TERM" "n/a"))
(or (getenv "HANGUL_KEYBOARD_TYPE") (setenv "HANGUL_KEYBOARD_TYPE" "3f"))

;; OS/Environment
(load "local-path")
; local-path: hypespec-root & quicklisp-root
(require 'hangul) ; New Korean Input
(load "zenburn") ; color
(load "my-hangul") ; Korean
(prefer-coding-system 'utf-8) ; This should be after loading my-hangul

(load "mousewheel") ; Mousewheel
(load "xterm") ; Xterm & modeline
(load "parenthesis") ; paredit, match-paren, and mic-paren
(require 'darkroom-mode)
(global-set-key [f6] 'darkroom-mode)
(require 'iswitchb) ; enhanced C-x b
;(iswitchb-default-keybindings)
;(load "x11-setting") ; X11 font
(iswitchb-mode)
;(require 'tramp)
;(require 'recentf)
;(recentf-mode 1)
;(load "sunrise-commander")
;(fset 'yes-or-no-p 'y-or-n-p)
(add-to-list 'load-path "~/emacs/emacs-helm")
(require 'helm-config)
(setq dired-listing-switches "-al --time-style iso")
(setq w3m-use-cookies t)
;; Language
(load "c")
(load "j")
;(load "haskell")
;(load "erlang")
;(load "lisp")
;(load "haskell")
;(load "parenscript")
(load (expand-file-name (concat quicklisp-root "slime-helper.el")))
(load "php-mode")
; multi-web-mode
(require 'multi-web-mode)
(setq mweb-default-major-mode 'html-mode)
(setq mweb-tags '((php-mode "<\\?php\\|<\\? \\|<\\?=" "\\?>")
                  (js-mode "<script +\\(type=\"text/javascript\"\\|language=\"javascript\"\\)[^>]*>" "</script>")
                  (css-mode "<style +type=\"text/css\"[^>]*>" "</style>")))
(setq mweb-filename-extensions '("php" "htm" "html" "ctp" "phtml" "php4" "php5"))
(multi-web-global-mode 0)
(require 'web-mode)
(add-to-list 'auto-mode-alist '("\\.phtml\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.tpl\\.php\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.[agj]sp\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.as[cp]x\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.erb\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.mustache\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.djhtml\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.html?\\'" . web-mode))

;; Global Hotkey
(global-set-key (kbd "M-C") 'compile)
(global-set-key (quote [C-up]) (quote scroll-down))
(global-set-key (quote [C-down]) (quote scroll-up))
(global-set-key (quote [67108896]) (quote toggle-korean-input-method))

;; Misc Setting
(setq tramp-default-method "scp")
(setq lpr-command "vi"
      lpr-sqitches '("/p")
      printer-name nil)
(setq browse-url-browser-function 'w3m-browse-url
      w3m-pop-up-windows t
      w3m-pop-up-frames t
;      common-lisp-hyperspec-root "/usr/share/doc/hyperspec-7.0/HyperSpec/"
      special-display-buffer-names (cons "*w3m*" special-display-buffer-names))
(setq message-log-max 2048)
(setq gnus-select-method '(nntp "news.kornet.net")
      imap-ssl-program "/usr/bin/openssl s_client -ssl3 -connect %s:%p"
      gnus-secondary-select-methods '((nnimap "ns.aratech.co.kr"
				       (nnimap-address "127.0.0.1")
					;; (nnimap-stream tls)
				       (nnimap-list-pattern ("INBOX")))))
;(set-fontset-font "fontset-default" '(#x1100 . #xffdc) '("Malgun Gothic" . "unicode-bmp"))
;(set-fontset-font "fontset-default" '(#xe0bc . #xf66e) '("New Gulim" . "unicode-bmp"))

;; Local Setting
(defun j1 () ; work envirnment
  "work environment j5k"
  (interactive)
  (set-default 'compile-command "(cd ~/Cache/j5k_cvs; LANG=C make -j8 -k j5k)")
  (visit-tags-table "~/Cache/j5k_cvs"))

(defun j2 () ; work envirnment
  "work environment kraken"
  (interactive)
;  (set-default 'compile-command "(cd ~/Cache/Kraken3_work; LANG=C make -j8 -k j7k)")
;  (visit-tags-table "~/Cache/Kraken3_work")
  (set-default 'compile-command "(cd ~/Cache/j5k_1_8; LANG=C make -j8 -k j5k)")
  (visit-tags-table "~/Cache/j5k_1_8")
)

(defun windows-local ()
  "windows environement"
  (require 'w32-fullscreen)
  (global-set-key (quote [M-return]) 'w32-fullscreen)
  (global-set-key [C-kanji] (quote toggle-korean-input-method))
  (setq browse-url-browser-function 'browse-url-default-windows-browser)
  (setq inferior-lisp-program "sbcl.exe")
  (setq load-path
	(cons "d:\\apps\\erl5.8.4\\lib\\tools-2.6.6.4\\emacs" load-path))
  (setq erlang-root-dir "d:\\apps\\erl5.8.4")
  (setq exec-path (cons "d:\\apps\\erl5.8.4\\bin" exec-path))
  (require 'erlang-start)
  )

(defun linux-local ()
  "linux environment, official work mode"
  (require 'w3m-load)
  (setq lpr-command "gtklp")
  (global-set-key (kbd "C-c h") 'helm-mini)
  (setq inferior-lisp-program "sbcl")
  (setq erlang-root-dir "/usr/lib/erlang/")
  (setq erlang-emacs-dir "/usr/lib/erlang/lib/tools-2.6.6.1/emacs")
  (load "erlang")
  (j2))

(defun osx-local ()
  "macbook environment"
;  (global-set-key (quote [M-return]) 'ns-toggle-fullscreen)
  (global-set-key (quote [M-return]) 'toggle-frame-fullscreen)
  (setq browse-url-browser-function 'browse-url-generic
	common-lisp-hyperspec-root "/Users/cwyang/hyperspec7.0/HyperSpec/"  
  )
  (setq browse-url-generic-program
	(if (file-exists-p "/usr/bin/open")
	    "/usr/bin/open"))
  (setq inferior-lisp-program "/usr/local/bin/sbcl")
;  (setq erlang-root-dir "/usr/local/lib/erlang/")
;  (setq erlang-emacs-dir "/usr/local/lib/erlang/lib/tools-2.6.6.3/emacs")
;  (load "erlang")
  (setq mac-option-modifier 'ctrl)
  (add-to-list 'load-path "/Users/cwyang/haskell-mode/")
  (load "haskell-mode-autoloads.el")
  (setq mac-command-modifier 'meta))

(defun undefined-local ()
  "environment cannot be determined"
  (interactive)
  (message  "environment cannot be determined"))

(cond ((string= system-type "windows-nt")
       (windows-local))
      ((string= system-type "gnu/linux")
       (linux-local))
      ((string= system-type "darwin")
       (osx-local))
      (t (undefined-local)))

;; Zenburn!
(when (window-system)(zenburn))
(redraw-frame (selected-frame))
(set-default-font "Terminus 12")
;(message "Loading emacs.el... done")
